// Complete Service Communication Map
// Service-level data flow and API endpoints
digraph ServiceCommunication {
    rankdir=LR;

    // Font settings and background for readability
    graph [fontsize=14, fontname="Arial", bgcolor="#f5f5f5", style=filled];
    node [shape=box, style=filled, fontsize=12, fontname="Arial"];
    edge [fontsize=10, fontname="Arial"];

    // Frontend
    subgraph cluster_frontend {
        label="Frontend (Port 3000)";
        fillcolor=lightyellow;
        style=filled;

        UI [label="React UI Components", fillcolor="#ffebee"];
        Store [label="Zustand State", fillcolor=wheat];
        API [label="API Client\nwretch", fillcolor=wheat];
    }

    // Backend
    subgraph cluster_backend {
        label="Backend (Port 8000)";
        fillcolor=lightgreen;
        style=filled;

        Router [label="FastAPI Routers\n126 endpoints", fillcolor="#e8f5e9"];
        Service [label="Service Layer", fillcolor=palegreen];
        AgentMgr [label="Agent Manager", fillcolor=palegreen];
    }

    // Medical Catalog
    subgraph cluster_catalog {
        label="Medical Catalog (Port 8001)";
        fillcolor=lightpink;
        style=filled;

        CatAPI [label="Biomarker API\n21 endpoints", fillcolor="#fff3e0"];
        Qdrant2 [label="Qdrant Client", fillcolor=pink];
    }

    // Connections
    UI -> Store [label="User Actions"];
    Store -> API [label="State Changes"];
    API -> Router [label="POST /api/v1/medical-agent/\nsession/{id}/send"];
    API -> Router [label="GET /api/v1/graph-memory/\nmedical/*"];
    API -> Router [label="POST /api/v1/auth/*"];

    Router -> Service [label="Route Handler"];
    Service -> AgentMgr [label="Create/Run"];
    Service -> CatAPI [label="HTTP GET"];

    CatAPI -> Qdrant2 [label="Search"];
}
