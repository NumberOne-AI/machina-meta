// Diagram #5: Real-Time Chat Flow
// Streaming agent responses via Redis pub/sub and Server-Sent Events

digraph RealtimeChat {
    rankdir=LR;
    graph [fontsize=14, fontname="Arial", bgcolor="#f5f5f5", style=filled];
    node [shape=box, style=filled, fontsize=12, fontname="Arial"];
    edge [fontsize=10, fontname="Arial"];

    // Standard entities
    Browser [label="Web Browser", fillcolor=lightblue];
    NextJS [label="Next.js Frontend\nPort 3000", fillcolor=lightyellow];
    FastAPI [label="FastAPI Backend\nPort 8000", fillcolor=lightgreen];
    AgentSystem [label="Agent System\n23 agents", fillcolor=lightcyan];
    Redis [label="Redis\n6379", fillcolor=skyblue, shape=cylinder];

    // Chat message flow
    Browser -> NextJS [label="User types message"];
    NextJS -> FastAPI [label="HTTP POST\n/api/v1/medical-agent/\nsession/ID/send"];
    FastAPI -> AgentSystem [label="Python call\nprocess_message()"];

    // Real-time streaming via Redis
    AgentSystem -> Redis [label="Redis Protocol\nPUBLISH agent_event\n(streaming chunks)", color=red];
    Redis -> FastAPI [label="Redis Protocol\nSUBSCRIBE agent_event", color=red];
    FastAPI -> NextJS [label="Server-Sent Events\nStreaming response", style=dashed, color=red];
    NextJS -> Browser [label="DOM update\nShow chunks", style=dashed, color=red];

    // Final response
    AgentSystem -> FastAPI [label="Final response", style=dashed];
    FastAPI -> NextJS [label="HTTP 200\nJSON complete", style=dashed];
}
