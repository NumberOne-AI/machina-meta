<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 12.2.1 (0)
 -->
<!-- Title: DocumentProcessing Pages: 1 -->
<svg width="1745pt" height="2445pt"
 viewBox="0.00 0.00 1745.38 2444.72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2440.72)">
<title>DocumentProcessing</title>
<polygon fill="#f5f5f5" stroke="none" points="-4,4 -4,-2440.72 1741.38,-2440.72 1741.38,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_file_storage</title>
<polygon fill="lightgreen" stroke="black" points="19.38,-1886.97 19.38,-2322.22 295.38,-2322.22 295.38,-1886.97 19.38,-1886.97"/>
<text text-anchor="middle" x="157.38" y="-2304.92" font-family="Arial" font-size="14.00">File Storage Service (Port 8000)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_docproc</title>
<polygon fill="lightyellow" stroke="black" points="25.38,-1127.19 25.38,-1450.44 327.38,-1450.44 327.38,-1127.19 25.38,-1127.19"/>
<text text-anchor="middle" x="176.38" y="-1433.14" font-family="Arial" font-size="14.00">Document Processing Service (Port 8000)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_pipeline</title>
<polygon fill="lightcyan" stroke="black" points="411.38,-1127.44 411.38,-2047.47 579.38,-2047.47 579.38,-1127.44 411.38,-1127.44"/>
<text text-anchor="middle" x="495.38" y="-2030.17" font-family="Arial" font-size="14.00">Extraction Pipeline</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_engine</title>
<polygon fill="lightpink" stroke="black" points="1104.38,-8 1104.38,-1085.19 1488.38,-1085.19 1488.38,-8 1104.38,-8"/>
<text text-anchor="middle" x="1296.38" y="-1067.89" font-family="Arial" font-size="14.00">Medical Data Engine</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_catalog</title>
<polygon fill="lavender" stroke="black" points="1496.38,-106.5 1496.38,-392.44 1729.38,-392.44 1729.38,-106.5 1496.38,-106.5"/>
<text text-anchor="middle" x="1612.88" y="-375.14" font-family="Arial" font-size="14.00">Medical Catalog Service (Port 8001)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_neo4j</title>
<polygon fill="lightgray" stroke="black" points="421.38,-549.44 421.38,-837.94 1033.38,-837.94 1033.38,-549.44 421.38,-549.44"/>
<text text-anchor="middle" x="727.38" y="-820.64" font-family="Arial" font-size="14.00">Neo4j Graph Database</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_timing</title>
<polygon fill="white" stroke="black" points="725.38,-2139.47 725.38,-2428.72 911.38,-2428.72 911.38,-2139.47 725.38,-2139.47"/>
<text text-anchor="middle" x="818.38" y="-2411.42" font-family="Arial" font-size="14.00">Performance Metrics</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_data_model</title>
<polygon fill="white" stroke="black" points="1130.38,-2165.97 1130.38,-2402.22 1340.38,-2402.22 1340.38,-2165.97 1130.38,-2165.97"/>
<text text-anchor="middle" x="1235.38" y="-2384.92" font-family="Arial" font-size="14.00">Biomarker Data Model</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_pattern</title>
<polygon fill="white" stroke="black" points="1454.38,-2152.97 1454.38,-2415.22 1646.38,-2415.22 1646.38,-2152.97 1454.38,-2152.97"/>
<text text-anchor="middle" x="1550.38" y="-2397.92" font-family="Arial" font-size="14.00">Instanceâ†’Type Pattern</text>
</g>
<!-- user -->
<g id="node1" class="node">
<title>user</title>
<polygon fill="lightblue" stroke="black" points="258.38,-1741.83 204.38,-1741.83 204.38,-1705.83 258.38,-1705.83 258.38,-1741.83"/>
<text text-anchor="middle" x="231.38" y="-1719.55" font-family="Arial" font-size="12.00">User</text>
</g>
<!-- frontend -->
<g id="node2" class="node">
<title>frontend</title>
<polygon fill="lightyellow" stroke="black" points="211,-1545.81 99.75,-1545.81 99.75,-1509.31 211,-1509.31 211,-1545.81"/>
<text text-anchor="middle" x="155.38" y="-1530.41" font-family="Arial" font-size="12.00">Frontend (Next.js)</text>
<text text-anchor="middle" x="155.38" y="-1516.16" font-family="Arial" font-size="12.00">Port 3000</text>
</g>
<!-- user&#45;&gt;frontend -->
<g id="edge1" class="edge">
<title>user&#45;&gt;frontend</title>
<path fill="none" stroke="black" d="M230.51,-1705.6C228.24,-1679.25 220.04,-1629.03 190.38,-1600.94 168.61,-1580.32 143.52,-1606.8 125.38,-1582.94 118.81,-1574.31 122.03,-1564.08 128.35,-1554.83"/>
<polygon fill="black" stroke="black" points="130.97,-1557.17 134.52,-1547.18 125.52,-1552.77 130.97,-1557.17"/>
<text text-anchor="middle" x="167.38" y="-1573.44" font-family="Arial" font-size="10.00">Upload PDF/Image</text>
</g>
<!-- frontend&#45;&gt;user -->
<g id="edge55" class="edge">
<title>frontend&#45;&gt;user</title>
<path fill="none" stroke="black" d="M185.86,-1546.14C194.81,-1552.78 203.7,-1561.14 209.38,-1570.94 231.62,-1609.38 234.23,-1662.17 233.33,-1694.31"/>
<polygon fill="black" stroke="black" points="229.85,-1693.9 232.92,-1704.04 236.84,-1694.19 229.85,-1693.9"/>
<text text-anchor="middle" x="252.91" y="-1573.44" font-family="Arial" font-size="10.00">Show biomarkers</text>
</g>
<!-- file_api -->
<g id="node3" class="node">
<title>file_api</title>
<polygon fill="green" stroke="black" points="284.25,-2290.47 168.5,-2290.47 168.5,-2253.97 284.25,-2253.97 284.25,-2290.47"/>
<text text-anchor="middle" x="226.38" y="-2275.07" font-family="Arial" font-size="12.00">POST /files/upload</text>
<text text-anchor="middle" x="226.38" y="-2260.82" font-family="Arial" font-size="12.00">Router</text>
</g>
<!-- frontend&#45;&gt;file_api -->
<g id="edge2" class="edge">
<title>frontend&#45;&gt;file_api</title>
<path fill="none" stroke="black" d="M211.17,-1532.07C240.01,-1536.84 273.46,-1547.5 294.38,-1570.94 340.08,-1622.15 322.38,-1654.18 322.38,-1722.83 322.38,-2093.47 322.38,-2093.47 322.38,-2093.47 322.38,-2153.42 279.58,-2212.56 251.13,-2245.24"/>
<polygon fill="black" stroke="black" points="248.6,-2242.82 244.55,-2252.61 253.82,-2247.48 248.6,-2242.82"/>
<text text-anchor="middle" x="354.25" y="-1951.72" font-family="Arial" font-size="10.00">POST with file</text>
</g>
<!-- docproc_api -->
<g id="node9" class="node">
<title>docproc_api</title>
<polygon fill="yellow" stroke="black" points="189.12,-1418.69 33.62,-1418.69 33.62,-1382.19 189.12,-1382.19 189.12,-1418.69"/>
<text text-anchor="middle" x="111.38" y="-1403.29" font-family="Arial" font-size="12.00">POST /process_document</text>
<text text-anchor="middle" x="111.38" y="-1389.04" font-family="Arial" font-size="12.00">Router</text>
</g>
<!-- frontend&#45;&gt;docproc_api -->
<g id="edge10" class="edge">
<title>frontend&#45;&gt;docproc_api</title>
<path fill="none" stroke="black" d="M99.6,-1509.03C88.59,-1502.94 78.42,-1494.86 71.88,-1484.19 60.77,-1466.1 71.94,-1444.41 85.2,-1427.78"/>
<polygon fill="black" stroke="black" points="87.8,-1430.12 91.67,-1420.26 82.5,-1425.56 87.8,-1430.12"/>
<text text-anchor="middle" x="102.62" y="-1474.69" font-family="Arial" font-size="10.00">POST {file_id}</text>
</g>
<!-- sse_stream -->
<g id="node12" class="node">
<title>sse_stream</title>
<polygon fill="wheat" stroke="black" points="319.75,-1418.69 207,-1418.69 207,-1382.19 319.75,-1382.19 319.75,-1418.69"/>
<text text-anchor="middle" x="263.38" y="-1403.29" font-family="Arial" font-size="12.00">SSE Stream</text>
<text text-anchor="middle" x="263.38" y="-1389.04" font-family="Arial" font-size="12.00">GET /tasks/stream</text>
</g>
<!-- frontend&#45;&gt;sse_stream -->
<g id="edge13" class="edge">
<title>frontend&#45;&gt;sse_stream</title>
<path fill="none" stroke="black" d="M151,-1508.95C149.21,-1497.53 148.97,-1482.85 156.12,-1472.19 167.5,-1455.24 180.89,-1464.72 198.38,-1454.19 211.54,-1446.26 224.92,-1435.88 236.09,-1426.43"/>
<polygon fill="black" stroke="black" points="238.12,-1429.3 243.38,-1420.1 233.53,-1424.01 238.12,-1429.3"/>
<text text-anchor="middle" x="202.25" y="-1474.69" font-family="Arial" font-size="10.00">Subscribe to updates</text>
</g>
<!-- file_service -->
<g id="node4" class="node">
<title>file_service</title>
<polygon fill="lightgreen" stroke="black" points="250.75,-2110.47 174,-2110.47 174,-2074.47 250.75,-2074.47 250.75,-2110.47"/>
<text text-anchor="middle" x="212.38" y="-2088.19" font-family="Arial" font-size="12.00">FileService</text>
</g>
<!-- file_api&#45;&gt;file_service -->
<g id="edge3" class="edge">
<title>file_api&#45;&gt;file_service</title>
<path fill="none" stroke="black" d="M224.98,-2253.53C222.55,-2222.7 217.53,-2158.91 214.61,-2121.85"/>
<polygon fill="black" stroke="black" points="218.14,-2122.03 213.86,-2112.34 211.16,-2122.58 218.14,-2122.03"/>
</g>
<!-- storage_decision -->
<g id="node5" class="node">
<title>storage_decision</title>
<polygon fill="lightgreen" stroke="black" points="185.38,-2015.47 106.9,-1997.47 185.37,-1979.47 263.85,-1997.47 185.38,-2015.47"/>
<text text-anchor="middle" x="185.38" y="-1993.19" font-family="Arial" font-size="12.00">Storage Type</text>
</g>
<!-- file_service&#45;&gt;storage_decision -->
<g id="edge4" class="edge">
<title>file_service&#45;&gt;storage_decision</title>
<path fill="none" stroke="black" d="M207.3,-2073.98C203.31,-2060.26 197.7,-2040.93 193.15,-2025.27"/>
<polygon fill="black" stroke="black" points="196.64,-2024.72 190.49,-2016.09 189.92,-2026.67 196.64,-2024.72"/>
</g>
<!-- gcs -->
<g id="node6" class="node">
<title>gcs</title>
<polygon fill="palegreen" stroke="black" points="163,-1930.97 27.75,-1930.97 27.75,-1894.97 163,-1894.97 163,-1930.97"/>
<text text-anchor="middle" x="95.38" y="-1908.69" font-family="Arial" font-size="12.00">Google Cloud Storage</text>
</g>
<!-- storage_decision&#45;&gt;gcs -->
<g id="edge5" class="edge">
<title>storage_decision&#45;&gt;gcs</title>
<path fill="none" stroke="black" d="M156.81,-1985.65C144.32,-1979.85 130.2,-1971.71 119.88,-1961.22 114.3,-1955.56 109.7,-1948.37 106.06,-1941.31"/>
<polygon fill="black" stroke="black" points="109.42,-1940.24 102.04,-1932.65 103.07,-1943.19 109.42,-1940.24"/>
<text text-anchor="middle" x="149.12" y="-1951.72" font-family="Arial" font-size="10.00">GCS enabled</text>
</g>
<!-- local_fs -->
<g id="node7" class="node">
<title>local_fs</title>
<polygon fill="palegreen" stroke="black" points="287.38,-1930.97 181.38,-1930.97 181.38,-1894.97 287.38,-1894.97 287.38,-1930.97"/>
<text text-anchor="middle" x="234.38" y="-1908.69" font-family="Arial" font-size="12.00">Local Filesystem</text>
</g>
<!-- storage_decision&#45;&gt;local_fs -->
<g id="edge6" class="edge">
<title>storage_decision&#45;&gt;local_fs</title>
<path fill="none" stroke="black" d="M182.13,-1979.84C181.11,-1970.36 181.3,-1958.54 186.12,-1949.22 188.05,-1945.5 190.57,-1942.08 193.45,-1938.95"/>
<polygon fill="black" stroke="black" points="195.61,-1941.72 200.62,-1932.38 190.88,-1936.55 195.61,-1941.72"/>
<text text-anchor="middle" x="211.25" y="-1951.72" font-family="Arial" font-size="10.00">Local mode</text>
</g>
<!-- postgres_file -->
<g id="node8" class="node">
<title>postgres_file</title>
<path fill="lightblue" stroke="black" d="M148.75,-1824.38C148.75,-1836.7 115.41,-1846.72 74.38,-1846.72 33.34,-1846.72 0,-1836.7 0,-1824.38 0,-1824.38 0,-1623.28 0,-1623.28 0,-1610.95 33.34,-1600.94 74.38,-1600.94 115.41,-1600.94 148.75,-1610.95 148.75,-1623.28 148.75,-1623.28 148.75,-1824.38 148.75,-1824.38"/>
<path fill="none" stroke="black" d="M148.75,-1824.38C148.75,-1812.05 115.41,-1802.03 74.38,-1802.03 33.34,-1802.03 0,-1812.05 0,-1824.38"/>
<text text-anchor="middle" x="74.38" y="-1797.8" font-family="Arial" font-size="12.00">PostgreSQL</text>
<text text-anchor="middle" x="74.38" y="-1783.55" font-family="Arial" font-size="12.00">FileRecord Table</text>
<text text-anchor="middle" x="74.38" y="-1755.3" font-family="Arial" font-size="12.00">Columns:</text>
<text text-anchor="middle" x="74.38" y="-1741.05" font-family="Arial" font-size="12.00">&#45; file_id (UUID)</text>
<text text-anchor="middle" x="74.38" y="-1726.8" font-family="Arial" font-size="12.00">&#45; filename</text>
<text text-anchor="middle" x="74.38" y="-1712.55" font-family="Arial" font-size="12.00">&#45; mimetype</text>
<text text-anchor="middle" x="74.38" y="-1698.3" font-family="Arial" font-size="12.00">&#45; size</text>
<text text-anchor="middle" x="74.38" y="-1684.05" font-family="Arial" font-size="12.00">&#45; storage_path</text>
<text text-anchor="middle" x="74.38" y="-1669.8" font-family="Arial" font-size="12.00">&#45; user_id</text>
<text text-anchor="middle" x="74.38" y="-1655.55" font-family="Arial" font-size="12.00">&#45; created_at</text>
<text text-anchor="middle" x="74.38" y="-1641.3" font-family="Arial" font-size="12.00">&#45; document_reference_id</text>
</g>
<!-- gcs&#45;&gt;postgres_file -->
<g id="edge7" class="edge">
<title>gcs&#45;&gt;postgres_file</title>
<path fill="none" stroke="black" d="M93.44,-1894.7C92.37,-1885.18 90.94,-1872.4 89.33,-1858.11"/>
<polygon fill="black" stroke="black" points="92.84,-1857.96 88.24,-1848.41 85.88,-1858.74 92.84,-1857.96"/>
<text text-anchor="middle" x="104.11" y="-1867.22" font-family="Arial" font-size="10.00">file_id</text>
</g>
<!-- local_fs&#45;&gt;postgres_file -->
<g id="edge8" class="edge">
<title>local_fs&#45;&gt;postgres_file</title>
<path fill="none" stroke="black" d="M191.38,-1894.54C185.01,-1891.99 178.53,-1889.4 172.38,-1886.97 160.63,-1882.33 155.12,-1885.33 145.88,-1876.72 138.9,-1870.22 132.54,-1862.91 126.75,-1855.09"/>
<polygon fill="black" stroke="black" points="129.67,-1853.15 121.08,-1846.94 123.92,-1857.15 129.67,-1853.15"/>
<text text-anchor="middle" x="158.62" y="-1867.22" font-family="Arial" font-size="10.00">file_id</text>
</g>
<!-- postgres_file&#45;&gt;frontend -->
<g id="edge9" class="edge">
<title>postgres_file&#45;&gt;frontend</title>
<path fill="none" stroke="black" d="M42.97,-1600.59C44.75,-1590.09 48.34,-1580.02 54.38,-1570.94 62.64,-1558.51 75.33,-1549.72 88.96,-1543.5"/>
<polygon fill="black" stroke="black" points="90.14,-1546.8 98.1,-1539.8 87.52,-1540.31 90.14,-1546.8"/>
<text text-anchor="middle" x="85.88" y="-1573.44" font-family="Arial" font-size="10.00">FileRecordOut</text>
</g>
<!-- task_queue -->
<g id="node10" class="node">
<title>task_queue</title>
<polygon fill="wheat" stroke="black" points="177.62,-1298.69 37.12,-1298.69 37.12,-1219.69 177.62,-1219.69 177.62,-1298.69"/>
<text text-anchor="middle" x="107.38" y="-1283.29" font-family="Arial" font-size="12.00">Task Queue Manager</text>
<text text-anchor="middle" x="107.38" y="-1255.04" font-family="Arial" font-size="12.00">Limits:</text>
<text text-anchor="middle" x="107.38" y="-1240.79" font-family="Arial" font-size="12.00">&#45; Global: 10 concurrent</text>
<text text-anchor="middle" x="107.38" y="-1226.54" font-family="Arial" font-size="12.00">&#45; Per&#45;user: 5 concurrent</text>
</g>
<!-- docproc_api&#45;&gt;task_queue -->
<g id="edge11" class="edge">
<title>docproc_api&#45;&gt;task_queue</title>
<path fill="none" stroke="black" d="M110.87,-1381.8C110.35,-1363.84 109.53,-1335.16 108.81,-1310.16"/>
<polygon fill="black" stroke="black" points="112.32,-1310.39 108.53,-1300.49 105.32,-1310.59 112.32,-1310.39"/>
<text text-anchor="middle" x="134.38" y="-1319.19" font-family="Arial" font-size="10.00">Queue task</text>
</g>
<!-- background_worker -->
<g id="node11" class="node">
<title>background_worker</title>
<polygon fill="wheat" stroke="black" points="161.25,-1171.69 39.5,-1171.69 39.5,-1135.19 161.25,-1135.19 161.25,-1171.69"/>
<text text-anchor="middle" x="100.38" y="-1156.29" font-family="Arial" font-size="12.00">Background Worker</text>
<text text-anchor="middle" x="100.38" y="-1142.04" font-family="Arial" font-size="12.00">(Thread Pool)</text>
</g>
<!-- task_queue&#45;&gt;background_worker -->
<g id="edge12" class="edge">
<title>task_queue&#45;&gt;background_worker</title>
<path fill="none" stroke="black" d="M104.75,-1219.26C103.95,-1207.35 103.08,-1194.47 102.33,-1183.35"/>
<polygon fill="black" stroke="black" points="105.83,-1183.36 101.67,-1173.62 98.85,-1183.83 105.83,-1183.36"/>
<text text-anchor="middle" x="140.21" y="-1192.19" font-family="Arial" font-size="10.00">Assign to worker</text>
</g>
<!-- load_file -->
<g id="node13" class="node">
<title>load_file</title>
<polygon fill="cyan" stroke="black" points="534.88,-2015.72 419.88,-2015.72 419.88,-1979.22 534.88,-1979.22 534.88,-2015.72"/>
<text text-anchor="middle" x="477.38" y="-2000.32" font-family="Arial" font-size="12.00">1. Load File</text>
<text text-anchor="middle" x="477.38" y="-1986.07" font-family="Arial" font-size="12.00">Fetch from storage</text>
</g>
<!-- background_worker&#45;&gt;load_file -->
<g id="edge14" class="edge">
<title>background_worker&#45;&gt;load_file</title>
<path fill="none" stroke="black" d="M68.21,-1172.12C40.65,-1189.9 5.38,-1220.09 5.38,-1258.19 5.38,-1528.56 5.38,-1528.56 5.38,-1528.56 5.38,-1558.3 19.07,-1567.31 44.38,-1582.94 87.64,-1609.66 121.5,-1564.9 157.38,-1600.94 235.36,-1679.28 126.09,-1760.59 195.38,-1846.72 226.44,-1885.34 253.33,-1868.63 299.38,-1886.97 303.61,-1888.66 447.97,-1946.18 451.38,-1949.22 457.38,-1954.58 462.29,-1961.67 466.16,-1968.72"/>
<polygon fill="black" stroke="black" points="462.89,-1970.01 470.42,-1977.47 469.18,-1966.94 462.89,-1970.01"/>
</g>
<!-- sse_stream&#45;&gt;frontend -->
<g id="edge54" class="edge">
<title>sse_stream&#45;&gt;frontend</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M264.67,-1419.16C265.05,-1437.34 262.9,-1465.52 248.38,-1484.19 241.19,-1493.42 231.54,-1500.71 221.17,-1506.44"/>
<polygon fill="black" stroke="black" points="219.81,-1503.21 212.41,-1510.8 222.93,-1509.47 219.81,-1503.21"/>
<text text-anchor="middle" x="281.62" y="-1474.69" font-family="Arial" font-size="10.00">SSE events</text>
</g>
<!-- load_file&#45;&gt;gcs -->
<g id="edge15" class="edge">
<title>load_file&#45;&gt;gcs</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M408.13,-1990.8C364.74,-1985.9 308.1,-1977.01 259.88,-1961.22 248.73,-1957.57 247.36,-1953.33 236.38,-1949.22 222.67,-1944.08 192.44,-1936.36 163.46,-1929.46"/>
<polygon fill="black" stroke="black" points="407.61,-1994.26 417.93,-1991.86 408.36,-1987.3 407.61,-1994.26"/>
<text text-anchor="middle" x="280.12" y="-1951.72" font-family="Arial" font-size="10.00">Fetch file</text>
</g>
<!-- load_file&#45;&gt;local_fs -->
<g id="edge16" class="edge">
<title>load_file&#45;&gt;local_fs</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M433.77,-1973.42C411.47,-1961.67 388.71,-1949.71 387.38,-1949.22 355.17,-1937.28 317.6,-1928.56 287.75,-1922.77"/>
<polygon fill="black" stroke="black" points="432.09,-1976.49 442.57,-1978.07 435.36,-1970.3 432.09,-1976.49"/>
<text text-anchor="middle" x="430.55" y="-1951.72" font-family="Arial" font-size="10.00">Fetch file</text>
</g>
<!-- convert_pdf -->
<g id="node14" class="node">
<title>convert_pdf</title>
<polygon fill="cyan" stroke="black" points="563.12,-1931.22 419.62,-1931.22 419.62,-1894.72 563.12,-1894.72 563.12,-1931.22"/>
<text text-anchor="middle" x="491.38" y="-1915.82" font-family="Arial" font-size="12.00">2. Convert PDF</text>
<text text-anchor="middle" x="491.38" y="-1901.57" font-family="Arial" font-size="12.00">Max 3 concurrent pages</text>
</g>
<!-- load_file&#45;&gt;convert_pdf -->
<g id="edge17" class="edge">
<title>load_file&#45;&gt;convert_pdf</title>
<path fill="none" stroke="black" d="M480.34,-1978.97C482.14,-1968.36 484.48,-1954.57 486.55,-1942.43"/>
<polygon fill="black" stroke="black" points="489.93,-1943.38 488.16,-1932.93 483.03,-1942.21 489.93,-1943.38"/>
</g>
<!-- extract_metadata -->
<g id="node15" class="node">
<title>extract_metadata</title>
<polygon fill="cyan" stroke="black" points="537.38,-1749.2 419.38,-1749.2 419.38,-1698.45 537.38,-1698.45 537.38,-1749.2"/>
<text text-anchor="middle" x="478.38" y="-1733.8" font-family="Arial" font-size="12.00">3. Extract Metadata</text>
<text text-anchor="middle" x="478.38" y="-1719.55" font-family="Arial" font-size="12.00">MetadataAgent</text>
<text text-anchor="middle" x="478.38" y="-1705.3" font-family="Arial" font-size="12.00">(Gemini Vision)</text>
</g>
<!-- convert_pdf&#45;&gt;extract_metadata -->
<g id="edge18" class="edge">
<title>convert_pdf&#45;&gt;extract_metadata</title>
<path fill="none" stroke="black" d="M490.15,-1894.36C488.04,-1863.95 483.67,-1801 480.88,-1760.96"/>
<polygon fill="black" stroke="black" points="484.38,-1760.81 480.2,-1751.08 477.4,-1761.3 484.38,-1760.81"/>
</g>
<!-- extract_metadata&#45;&gt;sse_stream -->
<g id="edge21" class="edge">
<title>extract_metadata&#45;&gt;sse_stream</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M456.03,-1698.05C428.03,-1666.15 379.76,-1608.24 346.88,-1552.94 326.84,-1519.24 330.35,-1506.49 311.38,-1472.19 303.08,-1457.18 292.49,-1441.31 283.37,-1428.41"/>
<polygon fill="black" stroke="black" points="286.31,-1426.49 277.63,-1420.41 280.62,-1430.58 286.31,-1426.49"/>
<text text-anchor="middle" x="389.62" y="-1524.06" font-family="Arial" font-size="10.00">Emit: phase=detect</text>
</g>
<!-- extract_biomarkers -->
<g id="node16" class="node">
<title>extract_biomarkers</title>
<polygon fill="cyan" stroke="black" points="571,-1552.94 441.75,-1552.94 441.75,-1502.19 571,-1502.19 571,-1552.94"/>
<text text-anchor="middle" x="506.38" y="-1537.54" font-family="Arial" font-size="12.00">4. Extract Biomarkers</text>
<text text-anchor="middle" x="506.38" y="-1523.29" font-family="Arial" font-size="12.00">GenericAgent</text>
<text text-anchor="middle" x="506.38" y="-1509.04" font-family="Arial" font-size="12.00">(Gemini Vision)</text>
</g>
<!-- extract_metadata&#45;&gt;extract_biomarkers -->
<g id="edge22" class="edge">
<title>extract_metadata&#45;&gt;extract_biomarkers</title>
<path fill="none" stroke="black" d="M481.92,-1698.22C486.79,-1664.45 495.57,-1603.5 501.18,-1564.59"/>
<polygon fill="black" stroke="black" points="504.64,-1565.17 502.6,-1554.77 497.71,-1564.17 504.64,-1565.17"/>
</g>
<!-- gemini -->
<g id="node20" class="node">
<title>gemini</title>
<polygon fill="plum" stroke="black" points="721.12,-1742.08 595.62,-1742.08 595.62,-1705.58 721.12,-1705.58 721.12,-1742.08"/>
<text text-anchor="middle" x="658.38" y="-1726.68" font-family="Arial" font-size="12.00">Google Gemini API</text>
<text text-anchor="middle" x="658.38" y="-1712.43" font-family="Arial" font-size="12.00">Vision + Tool Calling</text>
</g>
<!-- extract_metadata&#45;&gt;gemini -->
<g id="edge19" class="edge">
<title>extract_metadata&#45;&gt;gemini</title>
<path fill="none" stroke="black" d="M537.81,-1723.83C552.64,-1723.83 568.73,-1723.83 584.18,-1723.83"/>
<polygon fill="black" stroke="black" points="583.78,-1727.33 593.78,-1723.83 583.78,-1720.33 583.78,-1727.33"/>
<text text-anchor="middle" x="566.5" y="-1729.33" font-family="Arial" font-size="10.00">API call</text>
</g>
<!-- extract_biomarkers&#45;&gt;sse_stream -->
<g id="edge25" class="edge">
<title>extract_biomarkers&#45;&gt;sse_stream</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M446.03,-1501.72C433.47,-1496.2 420.4,-1490.19 408.38,-1484.19 371.38,-1465.7 330.58,-1442.12 301.71,-1424.86"/>
<polygon fill="black" stroke="black" points="303.7,-1421.97 293.32,-1419.82 300.09,-1427.97 303.7,-1421.97"/>
<text text-anchor="middle" x="454.88" y="-1474.69" font-family="Arial" font-size="10.00">Emit: phase=process</text>
</g>
<!-- normalize -->
<g id="node17" class="node">
<title>normalize</title>
<polygon fill="cyan" stroke="black" points="565.75,-1454.19 441,-1454.19 441,-1346.69 565.75,-1346.69 565.75,-1454.19"/>
<text text-anchor="middle" x="503.38" y="-1438.79" font-family="Arial" font-size="12.00">5. Normalize Names</text>
<text text-anchor="middle" x="503.38" y="-1424.54" font-family="Arial" font-size="12.00">NormalizerAgent</text>
<text text-anchor="middle" x="503.38" y="-1396.29" font-family="Arial" font-size="12.00">Rules:</text>
<text text-anchor="middle" x="503.38" y="-1382.04" font-family="Arial" font-size="12.00">&#45; Remove footnotes</text>
<text text-anchor="middle" x="503.38" y="-1367.79" font-family="Arial" font-size="12.00">&#45; Clean subscripts</text>
<text text-anchor="middle" x="503.38" y="-1353.54" font-family="Arial" font-size="12.00">&#45; Fix abbreviations</text>
</g>
<!-- extract_biomarkers&#45;&gt;normalize -->
<g id="edge26" class="edge">
<title>extract_biomarkers&#45;&gt;normalize</title>
<path fill="none" stroke="black" d="M505.78,-1501.84C505.53,-1491.38 505.23,-1478.65 504.92,-1465.81"/>
<polygon fill="black" stroke="black" points="508.42,-1465.99 504.69,-1456.08 501.43,-1466.16 508.42,-1465.99"/>
</g>
<!-- extract_biomarkers&#45;&gt;gemini -->
<g id="edge23" class="edge">
<title>extract_biomarkers&#45;&gt;gemini</title>
<path fill="none" stroke="black" d="M558.53,-1553.25C566.42,-1558.39 574.03,-1564.3 580.38,-1570.94 615,-1607.18 637.91,-1661.8 649.48,-1694.71"/>
<polygon fill="black" stroke="black" points="646.08,-1695.61 652.61,-1703.95 652.71,-1693.36 646.08,-1695.61"/>
<text text-anchor="middle" x="606.77" y="-1573.44" font-family="Arial" font-size="10.00">API call</text>
</g>
<!-- deduplicate -->
<g id="node18" class="node">
<title>deduplicate</title>
<polygon fill="cyan" stroke="black" points="570.88,-1277.44 419.88,-1277.44 419.88,-1240.94 570.88,-1240.94 570.88,-1277.44"/>
<text text-anchor="middle" x="495.38" y="-1262.04" font-family="Arial" font-size="12.00">6. Deduplicate</text>
<text text-anchor="middle" x="495.38" y="-1247.79" font-family="Arial" font-size="12.00">Remove duplicate values</text>
</g>
<!-- normalize&#45;&gt;deduplicate -->
<g id="edge27" class="edge">
<title>normalize&#45;&gt;deduplicate</title>
<path fill="none" stroke="black" d="M500.33,-1346.4C499.2,-1326.85 497.98,-1305.46 497.02,-1288.87"/>
<polygon fill="black" stroke="black" points="500.54,-1289.03 496.47,-1279.25 493.55,-1289.43 500.54,-1289.03"/>
</g>
<!-- pipeline_result -->
<g id="node19" class="node">
<title>pipeline_result</title>
<polygon fill="lightcyan" stroke="black" points="563.75,-1171.44 469,-1171.44 469,-1135.44 563.75,-1135.44 563.75,-1171.44"/>
<text text-anchor="middle" x="516.38" y="-1149.16" font-family="Arial" font-size="12.00">PipelineResult</text>
</g>
<!-- deduplicate&#45;&gt;pipeline_result -->
<g id="edge28" class="edge">
<title>deduplicate&#45;&gt;pipeline_result</title>
<path fill="none" stroke="black" d="M498.94,-1240.59C502.12,-1224.84 506.85,-1201.47 510.58,-1183.04"/>
<polygon fill="black" stroke="black" points="514.01,-1183.76 512.56,-1173.26 507.15,-1182.37 514.01,-1183.76"/>
</g>
<!-- engine_service -->
<g id="node21" class="node">
<title>engine_service</title>
<polygon fill="pink" stroke="black" points="1480.12,-1053.44 1306.62,-1053.44 1306.62,-988.69 1480.12,-988.69 1480.12,-1053.44"/>
<text text-anchor="middle" x="1393.38" y="-1038.04" font-family="Arial" font-size="12.00">MedicalDataEngineService</text>
<text text-anchor="middle" x="1393.38" y="-1023.79" font-family="Arial" font-size="12.00">.process_raw_medical_data()</text>
<text text-anchor="middle" x="1393.38" y="-995.54" font-family="Arial" font-size="12.00">Queue task for patient</text>
</g>
<!-- pipeline_result&#45;&gt;engine_service -->
<g id="edge29" class="edge">
<title>pipeline_result&#45;&gt;engine_service</title>
<path fill="none" stroke="black" d="M564.01,-1151.39C711.76,-1147.66 1160.6,-1132.62 1297.38,-1085.19 1314.07,-1079.4 1330.71,-1070.06 1345.33,-1060.31"/>
<polygon fill="black" stroke="black" points="1347.14,-1063.31 1353.38,-1054.75 1343.16,-1057.55 1347.14,-1063.31"/>
<text text-anchor="middle" x="1319.35" y="-1107.69" font-family="Arial" font-size="10.00">EngineInput with</text>
<text text-anchor="middle" x="1319.35" y="-1095.69" font-family="Arial" font-size="10.00">DocumentResourcesNew</text>
</g>
<!-- gemini&#45;&gt;extract_metadata -->
<g id="edge20" class="edge">
<title>gemini&#45;&gt;extract_metadata</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M584.18,-1723.83C568.73,-1723.83 552.64,-1723.83 537.81,-1723.83"/>
<polygon fill="black" stroke="black" points="583.78,-1727.33 593.78,-1723.83 583.78,-1720.33 583.78,-1727.33"/>
<text text-anchor="middle" x="566.5" y="-1729.33" font-family="Arial" font-size="10.00">Metadata</text>
</g>
<!-- gemini&#45;&gt;extract_biomarkers -->
<g id="edge24" class="edge">
<title>gemini&#45;&gt;extract_biomarkers</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M647.85,-1694.57C636.15,-1666.9 614.68,-1625.43 583.38,-1600.94 562.62,-1584.7 545.99,-1601.08 526.88,-1582.94 518.68,-1575.16 513.73,-1563.78 510.76,-1553.44"/>
<polygon fill="black" stroke="black" points="644.56,-1695.79 651.56,-1703.74 651.05,-1693.16 644.56,-1695.79"/>
<text text-anchor="middle" x="551.62" y="-1573.44" font-family="Arial" font-size="10.00">Biomarkers</text>
</g>
<!-- engine_task_queue -->
<g id="node22" class="node">
<title>engine_task_queue</title>
<polygon fill="pink" stroke="black" points="1465.88,-940.69 1314.88,-940.69 1314.88,-875.94 1465.88,-875.94 1465.88,-940.69"/>
<text text-anchor="middle" x="1390.38" y="-925.29" font-family="Arial" font-size="12.00">Patient Task Queue</text>
<text text-anchor="middle" x="1390.38" y="-911.04" font-family="Arial" font-size="12.00">(asyncio.Queue)</text>
<text text-anchor="middle" x="1390.38" y="-882.79" font-family="Arial" font-size="12.00">One queue per patient_id</text>
</g>
<!-- engine_service&#45;&gt;engine_task_queue -->
<g id="edge30" class="edge">
<title>engine_service&#45;&gt;engine_task_queue</title>
<path fill="none" stroke="black" d="M1392.52,-988.33C1392.21,-977.09 1391.86,-964.25 1391.54,-952.24"/>
<polygon fill="black" stroke="black" points="1395.05,-952.47 1391.28,-942.57 1388.05,-952.66 1395.05,-952.47"/>
<text text-anchor="middle" x="1442.59" y="-961.19" font-family="Arial" font-size="10.00">Queue ProcessingTask</text>
</g>
<!-- task_worker -->
<g id="node23" class="node">
<title>task_worker</title>
<polygon fill="pink" stroke="black" points="1421,-784.81 1267.75,-784.81 1267.75,-705.81 1421,-705.81 1421,-784.81"/>
<text text-anchor="middle" x="1344.38" y="-769.41" font-family="Arial" font-size="12.00">TaskWorker</text>
<text text-anchor="middle" x="1344.38" y="-755.16" font-family="Arial" font-size="12.00">.run()</text>
<text text-anchor="middle" x="1344.38" y="-726.91" font-family="Arial" font-size="12.00">One worker per patient_id</text>
<text text-anchor="middle" x="1344.38" y="-712.66" font-family="Arial" font-size="12.00">Idle timeout: 300s</text>
</g>
<!-- engine_task_queue&#45;&gt;task_worker -->
<g id="edge31" class="edge">
<title>engine_task_queue&#45;&gt;task_worker</title>
<path fill="none" stroke="black" d="M1381.29,-875.5C1374.8,-852.81 1365.96,-821.85 1358.55,-795.93"/>
<polygon fill="black" stroke="black" points="1362,-795.27 1355.89,-786.62 1355.27,-797.19 1362,-795.27"/>
<text text-anchor="middle" x="1405.87" y="-848.44" font-family="Arial" font-size="10.00">Dequeue task</text>
</g>
<!-- engine_main -->
<g id="node24" class="node">
<title>engine_main</title>
<polygon fill="pink" stroke="black" points="1286.75,-629.31 1126,-629.31 1126,-564.56 1286.75,-564.56 1286.75,-629.31"/>
<text text-anchor="middle" x="1206.38" y="-613.91" font-family="Arial" font-size="12.00">MedicalDataEngine</text>
<text text-anchor="middle" x="1206.38" y="-599.66" font-family="Arial" font-size="12.00">.process()</text>
<text text-anchor="middle" x="1206.38" y="-571.41" font-family="Arial" font-size="12.00">Orchestrates all processors</text>
</g>
<!-- task_worker&#45;&gt;engine_main -->
<g id="edge32" class="edge">
<title>task_worker&#45;&gt;engine_main</title>
<path fill="none" stroke="black" d="M1307.76,-705.47C1288.02,-684.54 1263.71,-658.75 1243.84,-637.68"/>
<polygon fill="black" stroke="black" points="1246.63,-635.53 1237.22,-630.66 1241.54,-640.34 1246.63,-635.53"/>
<text text-anchor="middle" x="1313.24" y="-656.94" font-family="Arial" font-size="10.00">Call engine.process()</text>
</g>
<!-- biomarker_processor -->
<g id="node25" class="node">
<title>biomarker_processor</title>
<polygon fill="lightpink" stroke="black" points="1290.12,-509.44 1122.62,-509.44 1122.62,-430.44 1290.12,-430.44 1290.12,-509.44"/>
<text text-anchor="middle" x="1206.38" y="-494.04" font-family="Arial" font-size="12.00">BiomarkerProcessor</text>
<text text-anchor="middle" x="1206.38" y="-479.79" font-family="Arial" font-size="12.00">.process()</text>
<text text-anchor="middle" x="1206.38" y="-451.54" font-family="Arial" font-size="12.00">Filters low&#45;confidence</text>
<text text-anchor="middle" x="1206.38" y="-437.29" font-family="Arial" font-size="12.00">Invokes BiomarkerConverter</text>
</g>
<!-- engine_main&#45;&gt;biomarker_processor -->
<g id="edge35" class="edge">
<title>engine_main&#45;&gt;biomarker_processor</title>
<path fill="none" stroke="black" d="M1206.38,-564.07C1206.38,-551.06 1206.38,-535.69 1206.38,-521.23"/>
<polygon fill="black" stroke="black" points="1209.88,-521.4 1206.38,-511.4 1202.88,-521.4 1209.88,-521.4"/>
<text text-anchor="middle" x="1249.88" y="-529.94" font-family="Arial" font-size="10.00">Process biomarkers</text>
</g>
<!-- create_doc_ref -->
<g id="node33" class="node">
<title>create_doc_ref</title>
<polygon fill="gray" stroke="black" points="1025.62,-806.19 831.12,-806.19 831.12,-684.44 1025.62,-684.44 1025.62,-806.19"/>
<text text-anchor="middle" x="928.38" y="-790.79" font-family="Arial" font-size="12.00">Create DocumentReferenceNode</text>
<text text-anchor="middle" x="928.38" y="-762.54" font-family="Arial" font-size="12.00">Properties:</text>
<text text-anchor="middle" x="928.38" y="-748.29" font-family="Arial" font-size="12.00">&#45; uuid, name, file_id</text>
<text text-anchor="middle" x="928.38" y="-734.04" font-family="Arial" font-size="12.00">&#45; document_name</text>
<text text-anchor="middle" x="928.38" y="-719.79" font-family="Arial" font-size="12.00">&#45; report_date</text>
<text text-anchor="middle" x="928.38" y="-705.54" font-family="Arial" font-size="12.00">&#45; patient_id, user_id</text>
<text text-anchor="middle" x="928.38" y="-691.29" font-family="Arial" font-size="12.00">&#45; source_type, content_type</text>
</g>
<!-- engine_main&#45;&gt;create_doc_ref -->
<g id="edge33" class="edge">
<title>engine_main&#45;&gt;create_doc_ref</title>
<path fill="none" stroke="black" d="M1146.22,-629.61C1114.02,-646.56 1073.38,-667.96 1035.95,-687.67"/>
<polygon fill="black" stroke="black" points="1034.55,-684.45 1027.34,-692.21 1037.81,-690.64 1034.55,-684.45"/>
<text text-anchor="middle" x="1151.52" y="-656.94" font-family="Arial" font-size="10.00">Create document reference</text>
</g>
<!-- converter -->
<g id="node26" class="node">
<title>converter</title>
<polygon fill="lightpink" stroke="black" points="1299.88,-375.06 1112.88,-375.06 1112.88,-310.31 1299.88,-310.31 1299.88,-375.06"/>
<text text-anchor="middle" x="1206.38" y="-359.66" font-family="Arial" font-size="12.00">BiomarkerConverter</text>
<text text-anchor="middle" x="1206.38" y="-345.41" font-family="Arial" font-size="12.00">.handle_observation_types()</text>
<text text-anchor="middle" x="1206.38" y="-317.16" font-family="Arial" font-size="12.00">Creates ObservationTypeNodes</text>
</g>
<!-- biomarker_processor&#45;&gt;converter -->
<g id="edge36" class="edge">
<title>biomarker_processor&#45;&gt;converter</title>
<path fill="none" stroke="black" d="M1206.38,-429.99C1206.38,-416.31 1206.38,-400.85 1206.38,-386.83"/>
<polygon fill="black" stroke="black" points="1209.88,-386.98 1206.38,-376.98 1202.88,-386.98 1209.88,-386.98"/>
<text text-anchor="middle" x="1249.88" y="-402.94" font-family="Arial" font-size="10.00">BiomarkerConverter</text>
</g>
<!-- catalog_search -->
<g id="node27" class="node">
<title>catalog_search</title>
<polygon fill="lightpink" stroke="black" points="1480.12,-220.78 1282.62,-220.78 1282.62,-156.03 1480.12,-156.03 1480.12,-220.78"/>
<text text-anchor="middle" x="1381.38" y="-205.38" font-family="Arial" font-size="12.00">BiomarkerConverter</text>
<text text-anchor="middle" x="1381.38" y="-191.13" font-family="Arial" font-size="12.00">._search_biomarkers_in_catalog()</text>
<text text-anchor="middle" x="1381.38" y="-162.88" font-family="Arial" font-size="12.00">Batch vector search</text>
</g>
<!-- converter&#45;&gt;catalog_search -->
<g id="edge37" class="edge">
<title>converter&#45;&gt;catalog_search</title>
<path fill="none" stroke="black" d="M1242.64,-310.13C1269.88,-286.43 1307.36,-253.81 1336.49,-228.46"/>
<polygon fill="black" stroke="black" points="1338.47,-231.38 1343.72,-222.17 1333.88,-226.1 1338.47,-231.38"/>
<text text-anchor="middle" x="1305.68" y="-282.81" font-family="Arial" font-size="10.00">Search catalog</text>
</g>
<!-- create_obs_types -->
<g id="node34" class="node">
<title>create_obs_types</title>
<polygon fill="gray" stroke="black" points="812.88,-799.06 631.88,-799.06 631.88,-691.56 812.88,-691.56 812.88,-799.06"/>
<text text-anchor="middle" x="722.38" y="-783.66" font-family="Arial" font-size="12.00">Create ObservationTypeNodes</text>
<text text-anchor="middle" x="722.38" y="-755.41" font-family="Arial" font-size="12.00">Properties:</text>
<text text-anchor="middle" x="722.38" y="-741.16" font-family="Arial" font-size="12.00">&#45; catalog_id, unit</text>
<text text-anchor="middle" x="722.38" y="-726.91" font-family="Arial" font-size="12.00">&#45; name, display_name</text>
<text text-anchor="middle" x="722.38" y="-712.66" font-family="Arial" font-size="12.00">&#45; aliases, description</text>
<text text-anchor="middle" x="722.38" y="-698.41" font-family="Arial" font-size="12.00">&#45; unit_properties</text>
</g>
<!-- converter&#45;&gt;create_obs_types -->
<g id="edge44" class="edge">
<title>converter&#45;&gt;create_obs_types</title>
<path fill="none" stroke="black" d="M1172.25,-375.3C1154.62,-391.69 1132.78,-412.08 1113.38,-430.44 1057.89,-482.93 1038.41,-490.87 989.38,-549.44 959.54,-585.07 966.95,-606.54 931.38,-636.44 890.85,-670.49 869.4,-660.13 822.38,-684.44 821.47,-684.91 820.56,-685.38 819.65,-685.85"/>
<polygon fill="black" stroke="black" points="818.33,-682.6 811.16,-690.4 821.63,-688.77 818.33,-682.6"/>
<text text-anchor="middle" x="1083.97" y="-529.94" font-family="Arial" font-size="10.00">ObservationTypeFromCatalogInput</text>
</g>
<!-- dedup_engine -->
<g id="node28" class="node">
<title>dedup_engine</title>
<polygon fill="lightpink" stroke="black" points="1387.25,-66.5 1199.5,-66.5 1199.5,-16 1387.25,-16 1387.25,-66.5"/>
<text text-anchor="middle" x="1293.38" y="-51.1" font-family="Arial" font-size="12.00">deduplicate_biomarker_values()</text>
<text text-anchor="middle" x="1293.38" y="-22.85" font-family="Arial" font-size="12.00">Group by (catalog_id, unit)</text>
</g>
<!-- catalog_search&#45;&gt;dedup_engine -->
<g id="edge42" class="edge">
<title>catalog_search&#45;&gt;dedup_engine</title>
<path fill="none" stroke="black" d="M1362.06,-155.55C1347.9,-132.18 1328.68,-100.49 1314.18,-76.56"/>
<polygon fill="black" stroke="black" points="1317.24,-74.86 1309.06,-68.13 1311.25,-78.49 1317.24,-74.86"/>
<text text-anchor="middle" x="1365.98" y="-87" font-family="Arial" font-size="10.00">Deduplicate values</text>
</g>
<!-- catalog_api -->
<g id="node31" class="node">
<title>catalog_api</title>
<polygon fill="plum" stroke="black" points="1692.62,-360.69 1504.12,-360.69 1504.12,-324.69 1692.62,-324.69 1692.62,-360.69"/>
<text text-anchor="middle" x="1598.38" y="-338.41" font-family="Arial" font-size="12.00">POST /biomarkers/search_batch</text>
</g>
<!-- catalog_search&#45;&gt;catalog_api -->
<g id="edge38" class="edge">
<title>catalog_search&#45;&gt;catalog_api</title>
<path fill="none" stroke="black" d="M1426.71,-221.22C1467.65,-249.95 1526.99,-291.6 1564.1,-317.63"/>
<polygon fill="black" stroke="black" points="1562.05,-320.47 1572.24,-323.35 1566.07,-314.74 1562.05,-320.47"/>
<text text-anchor="middle" x="1550.12" y="-282.81" font-family="Arial" font-size="10.00">HTTP POST</text>
</g>
<!-- dedup_engine&#45;&gt;converter -->
<g id="edge43" class="edge">
<title>dedup_engine&#45;&gt;converter</title>
<path fill="none" stroke="black" d="M1211.2,-66.9C1193.06,-76.32 1176.08,-89.15 1165.38,-106.5 1129.01,-165.44 1149.02,-195.02 1165.38,-262.31 1168.49,-275.14 1174.06,-288.2 1180.12,-299.93"/>
<polygon fill="black" stroke="black" points="1176.94,-301.41 1184.79,-308.53 1183.09,-298.07 1176.94,-301.41"/>
<text text-anchor="middle" x="1219.38" y="-184.91" font-family="Arial" font-size="10.00">Deduplicated biomarkers</text>
</g>
<!-- patient_tracking -->
<g id="node29" class="node">
<title>patient_tracking</title>
<polygon fill="lightpink" stroke="black" points="1288.62,-1053.44 1112.12,-1053.44 1112.12,-988.69 1288.62,-988.69 1288.62,-1053.44"/>
<text text-anchor="middle" x="1200.38" y="-1038.04" font-family="Arial" font-size="12.00">BiomarkerConverter</text>
<text text-anchor="middle" x="1200.38" y="-1023.79" font-family="Arial" font-size="12.00">.handle_patient_tracking()</text>
<text text-anchor="middle" x="1200.38" y="-995.54" font-family="Arial" font-size="12.00">Create TRACKS relationships</text>
</g>
<!-- value_storage -->
<g id="node30" class="node">
<title>value_storage</title>
<polygon fill="lightpink" stroke="black" points="1296.75,-940.69 1112,-940.69 1112,-875.94 1296.75,-875.94 1296.75,-940.69"/>
<text text-anchor="middle" x="1204.38" y="-925.29" font-family="Arial" font-size="12.00">BiomarkerConverter</text>
<text text-anchor="middle" x="1204.38" y="-911.04" font-family="Arial" font-size="12.00">.handle_observation_values()</text>
<text text-anchor="middle" x="1204.38" y="-882.79" font-family="Arial" font-size="12.00">Create ObservationValueNodes</text>
</g>
<!-- patient_tracking&#45;&gt;value_storage -->
<g id="edge48" class="edge">
<title>patient_tracking&#45;&gt;value_storage</title>
<path fill="none" stroke="black" d="M1201.52,-988.33C1201.93,-977.09 1202.39,-964.25 1202.82,-952.24"/>
<polygon fill="black" stroke="black" points="1206.31,-952.69 1203.17,-942.57 1199.32,-952.43 1206.31,-952.69"/>
<text text-anchor="middle" x="1262.87" y="-961.19" font-family="Arial" font-size="10.00">Process observation values</text>
</g>
<!-- neo4j_db -->
<g id="node37" class="node">
<title>neo4j_db</title>
<path fill="lightblue" stroke="black" d="M816.88,-490.47C816.88,-492.99 793.79,-495.03 765.38,-495.03 736.96,-495.03 713.88,-492.99 713.88,-490.47 713.88,-490.47 713.88,-449.41 713.88,-449.41 713.88,-446.89 736.96,-444.84 765.38,-444.84 793.79,-444.84 816.88,-446.89 816.88,-449.41 816.88,-449.41 816.88,-490.47 816.88,-490.47"/>
<path fill="none" stroke="black" d="M816.88,-490.47C816.88,-487.95 793.79,-485.91 765.38,-485.91 736.96,-485.91 713.88,-487.95 713.88,-490.47"/>
<text text-anchor="middle" x="765.38" y="-472.79" font-family="Arial" font-size="12.00">Neo4j Database</text>
<text text-anchor="middle" x="765.38" y="-458.54" font-family="Arial" font-size="12.00">Port 7474, 7687</text>
</g>
<!-- patient_tracking&#45;&gt;neo4j_db -->
<g id="edge47" class="edge">
<title>patient_tracking&#45;&gt;neo4j_db</title>
<path fill="none" stroke="black" d="M1111.74,-1018.58C881.17,-1013.57 280.38,-992.52 280.38,-909.31 280.38,-909.31 280.38,-909.31 280.38,-595.94 280.38,-509.84 570.57,-482.15 702.02,-474.02"/>
<polygon fill="black" stroke="black" points="702.19,-477.52 711.96,-473.43 701.77,-470.53 702.19,-477.52"/>
<text text-anchor="middle" x="345.62" y="-741.81" font-family="Arial" font-size="10.00">Create TRACKS relationships</text>
</g>
<!-- create_obs_values -->
<g id="node35" class="node">
<title>create_obs_values</title>
<polygon fill="gray" stroke="black" points="613.75,-806.19 429,-806.19 429,-684.44 613.75,-684.44 613.75,-806.19"/>
<text text-anchor="middle" x="521.38" y="-790.79" font-family="Arial" font-size="12.00">Create ObservationValueNodes</text>
<text text-anchor="middle" x="521.38" y="-762.54" font-family="Arial" font-size="12.00">Properties:</text>
<text text-anchor="middle" x="521.38" y="-748.29" font-family="Arial" font-size="12.00">&#45; value, unit</text>
<text text-anchor="middle" x="521.38" y="-734.04" font-family="Arial" font-size="12.00">&#45; observation_date</text>
<text text-anchor="middle" x="521.38" y="-719.79" font-family="Arial" font-size="12.00">&#45; value_epoch</text>
<text text-anchor="middle" x="521.38" y="-705.54" font-family="Arial" font-size="12.00">&#45; patient_id, user_id</text>
<text text-anchor="middle" x="521.38" y="-691.29" font-family="Arial" font-size="12.00">&#45; source_type, source_id</text>
</g>
<!-- value_storage&#45;&gt;create_obs_values -->
<g id="edge49" class="edge">
<title>value_storage&#45;&gt;create_obs_values</title>
<path fill="none" stroke="black" d="M1111.73,-894.85C1066.94,-888.93 1012.38,-881.87 963.38,-875.94 812.42,-857.68 762.11,-900.16 623.38,-837.94 609.74,-831.82 596.66,-823.2 584.69,-813.66"/>
<polygon fill="black" stroke="black" points="587.26,-811.25 577.33,-807.55 582.78,-816.63 587.26,-811.25"/>
</g>
<!-- catalog_api&#45;&gt;catalog_search -->
<g id="edge41" class="edge">
<title>catalog_api&#45;&gt;catalog_search</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1531.49,-321.09C1518.56,-317.34 1505.08,-313.58 1492.38,-310.31 1456.13,-301 1437.33,-318.01 1410.12,-292.31 1390.84,-274.1 1384.13,-244.12 1381.96,-221.21"/>
<polygon fill="black" stroke="black" points="1530.17,-324.35 1540.75,-323.81 1532.14,-317.64 1530.17,-324.35"/>
<text text-anchor="middle" x="1460.75" y="-282.81" font-family="Arial" font-size="10.00">BiomarkerEntryResults</text>
</g>
<!-- qdrant -->
<g id="node32" class="node">
<title>qdrant</title>
<path fill="plum" stroke="black" d="M1685.62,-248.88C1685.62,-256.29 1659.52,-262.31 1627.38,-262.31 1595.23,-262.31 1569.12,-256.29 1569.12,-248.88 1569.12,-248.88 1569.12,-127.94 1569.12,-127.94 1569.12,-120.52 1595.23,-114.5 1627.38,-114.5 1659.52,-114.5 1685.62,-120.52 1685.62,-127.94 1685.62,-127.94 1685.62,-248.88 1685.62,-248.88"/>
<path fill="none" stroke="black" d="M1685.62,-248.88C1685.62,-241.46 1659.52,-235.44 1627.38,-235.44 1595.23,-235.44 1569.12,-241.46 1569.12,-248.88"/>
<text text-anchor="middle" x="1627.38" y="-226.76" font-family="Arial" font-size="12.00">Qdrant</text>
<text text-anchor="middle" x="1627.38" y="-212.51" font-family="Arial" font-size="12.00">Vector Search</text>
<text text-anchor="middle" x="1627.38" y="-184.26" font-family="Arial" font-size="12.00">Embeddings for:</text>
<text text-anchor="middle" x="1627.38" y="-170.01" font-family="Arial" font-size="12.00">&#45; Biomarker names</text>
<text text-anchor="middle" x="1627.38" y="-155.76" font-family="Arial" font-size="12.00">&#45; Aliases</text>
<text text-anchor="middle" x="1627.38" y="-141.51" font-family="Arial" font-size="12.00">&#45; Synonyms</text>
</g>
<!-- catalog_api&#45;&gt;qdrant -->
<g id="edge39" class="edge">
<title>catalog_api&#45;&gt;qdrant</title>
<path fill="none" stroke="black" d="M1593.28,-324.39C1590.34,-312.04 1587.75,-295.07 1590.62,-280.31 1591.05,-278.12 1591.53,-275.91 1592.06,-273.7"/>
<polygon fill="black" stroke="black" points="1595.43,-274.63 1594.65,-264.07 1588.67,-272.81 1595.43,-274.63"/>
<text text-anchor="middle" x="1625.5" y="-282.81" font-family="Arial" font-size="10.00">Vector similarity</text>
</g>
<!-- qdrant&#45;&gt;catalog_api -->
<g id="edge40" class="edge">
<title>qdrant&#45;&gt;catalog_api</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1665.12,-272.84C1664.83,-279.52 1663.38,-286.09 1660.38,-292.31 1654.04,-305.45 1642.32,-316.18 1630.77,-324.23"/>
<polygon fill="black" stroke="black" points="1668.63,-272.87 1664.65,-263.05 1661.63,-273.21 1668.63,-272.87"/>
<text text-anchor="middle" x="1682.76" y="-282.81" font-family="Arial" font-size="10.00">Matches</text>
</g>
<!-- create_doc_ref&#45;&gt;neo4j_db -->
<g id="edge34" class="edge">
<title>create_doc_ref&#45;&gt;neo4j_db</title>
<path fill="none" stroke="black" d="M945.45,-684.3C953.49,-643.21 956.54,-589.17 931.38,-549.44 908.71,-513.65 864.85,-493.86 827.9,-483.11"/>
<polygon fill="black" stroke="black" points="829.22,-479.84 818.65,-480.58 827.37,-486.59 829.22,-479.84"/>
<text text-anchor="middle" x="988.72" y="-593.44" font-family="Arial" font-size="10.00">Cypher CREATE</text>
</g>
<!-- create_obs_types&#45;&gt;patient_tracking -->
<g id="edge46" class="edge">
<title>create_obs_types&#45;&gt;patient_tracking</title>
<path fill="none" stroke="black" d="M776.04,-799.48C790.54,-812.71 806.6,-826.4 822.38,-837.94 909.32,-901.52 1021.93,-952.41 1101.55,-984.06"/>
<polygon fill="black" stroke="black" points="1100.08,-987.24 1110.66,-987.65 1102.64,-980.73 1100.08,-987.24"/>
<text text-anchor="middle" x="1049.44" y="-904.81" font-family="Arial" font-size="10.00">ObservationTypeNodes</text>
</g>
<!-- create_obs_types&#45;&gt;neo4j_db -->
<g id="edge45" class="edge">
<title>create_obs_types&#45;&gt;neo4j_db</title>
<path fill="none" stroke="black" d="M802.27,-691.27C819.3,-675.78 834.97,-657.32 844.38,-636.44 860.26,-601.18 859.23,-585.14 844.38,-549.44 836.74,-531.08 822.49,-514.81 808.18,-501.9"/>
<polygon fill="black" stroke="black" points="810.81,-499.55 800.94,-495.69 806.25,-504.86 810.81,-499.55"/>
<text text-anchor="middle" x="891.53" y="-593.44" font-family="Arial" font-size="10.00">Cypher MERGE</text>
</g>
<!-- create_relationships -->
<g id="node36" class="node">
<title>create_relationships</title>
<polygon fill="gray" stroke="black" points="729.12,-636.44 429.62,-636.44 429.62,-557.44 729.12,-557.44 729.12,-636.44"/>
<text text-anchor="middle" x="579.38" y="-621.04" font-family="Arial" font-size="12.00">Create Relationships</text>
<text text-anchor="middle" x="579.38" y="-592.79" font-family="Arial" font-size="12.00">DocumentReference&#45;[CONTAINS]&#45;&gt;ObservationType</text>
<text text-anchor="middle" x="579.38" y="-578.54" font-family="Arial" font-size="12.00">ObservationType&#45;[HAS_VALUE]&#45;&gt;ObservationValue</text>
<text text-anchor="middle" x="579.38" y="-564.29" font-family="Arial" font-size="12.00">Patient&#45;[HAS_OBSERVATION]&#45;&gt;ObservationValue</text>
</g>
<!-- create_obs_values&#45;&gt;create_relationships -->
<g id="edge51" class="edge">
<title>create_obs_values&#45;&gt;create_relationships</title>
<path fill="none" stroke="black" d="M545.13,-684.35C550.02,-672.02 555.11,-659.17 559.83,-647.27"/>
<polygon fill="black" stroke="black" points="563.05,-648.64 563.48,-638.05 556.54,-646.06 563.05,-648.64"/>
</g>
<!-- create_obs_values&#45;&gt;neo4j_db -->
<g id="edge50" class="edge">
<title>create_obs_values&#45;&gt;neo4j_db</title>
<path fill="none" stroke="black" d="M614.2,-689.13C617.28,-687.52 620.34,-685.95 623.38,-684.44 672.93,-659.7 704.04,-679.9 738.38,-636.44 753.88,-616.81 760.74,-548.96 763.57,-506.47"/>
<polygon fill="black" stroke="black" points="767.04,-506.93 764.17,-496.73 760.06,-506.5 767.04,-506.93"/>
<text text-anchor="middle" x="797.23" y="-593.44" font-family="Arial" font-size="10.00">Cypher CREATE</text>
</g>
<!-- create_relationships&#45;&gt;sse_stream -->
<g id="edge53" class="edge">
<title>create_relationships&#45;&gt;sse_stream</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M429.42,-622.04C357.56,-636.7 282.02,-657.77 258.38,-684.44 208.78,-740.38 234.38,-776.17 234.38,-850.94 234.38,-1260.19 234.38,-1260.19 234.38,-1260.19 234.38,-1299.3 245.47,-1343.31 253.94,-1371.19"/>
<polygon fill="black" stroke="black" points="250.57,-1372.16 256.91,-1380.65 257.25,-1370.06 250.57,-1372.16"/>
<text text-anchor="middle" x="283.5" y="-1017.56" font-family="Arial" font-size="10.00">Emit: phase=complete</text>
</g>
<!-- create_relationships&#45;&gt;neo4j_db -->
<g id="edge52" class="edge">
<title>create_relationships&#45;&gt;neo4j_db</title>
<path fill="none" stroke="black" d="M601.9,-557.22C609.51,-546.53 618.74,-535.63 629.12,-527.44 650.75,-510.38 678.27,-497.68 702.9,-488.69"/>
<polygon fill="black" stroke="black" points="703.9,-492.04 712.19,-485.44 701.59,-485.43 703.9,-492.04"/>
<text text-anchor="middle" x="690.25" y="-529.94" font-family="Arial" font-size="10.00">Cypher MATCH + CREATE</text>
</g>
<!-- timing -->
<g id="node38" class="node">
<title>timing</title>
<polygon fill="white" stroke="black" points="896.88,-2396.97 733.88,-2396.97 733.88,-2147.47 902.88,-2147.47 902.88,-2390.97 896.88,-2396.97"/>
<polyline fill="none" stroke="black" points="896.88,-2396.97 896.88,-2390.97"/>
<polyline fill="none" stroke="black" points="902.88,-2390.97 896.88,-2390.97"/>
<text text-anchor="middle" x="818.38" y="-2382.52" font-family="Arial" font-size="11.00">Typical Processing Times:</text>
<text text-anchor="middle" x="818.38" y="-2356.02" font-family="Arial" font-size="11.00">File Upload: 0.5&#45;2s</text>
<text text-anchor="middle" x="818.38" y="-2342.52" font-family="Arial" font-size="11.00">Queue Wait: 0&#45;30s</text>
<text text-anchor="middle" x="818.38" y="-2329.02" font-family="Arial" font-size="11.00">PDF Conversion: 1&#45;3s per page</text>
<text text-anchor="middle" x="818.38" y="-2315.52" font-family="Arial" font-size="11.00">Metadata Extraction: 2&#45;4s</text>
<text text-anchor="middle" x="818.38" y="-2302.02" font-family="Arial" font-size="11.00">Biomarker Extraction: 5&#45;15s</text>
<text text-anchor="middle" x="818.38" y="-2288.52" font-family="Arial" font-size="11.00">Normalization: &lt;1s</text>
<text text-anchor="middle" x="818.38" y="-2275.02" font-family="Arial" font-size="11.00">Medical Catalog Search: 1&#45;3s</text>
<text text-anchor="middle" x="818.38" y="-2261.52" font-family="Arial" font-size="11.00">Deduplication: &lt;1s</text>
<text text-anchor="middle" x="818.38" y="-2248.02" font-family="Arial" font-size="11.00">Graph Storage: 2&#45;5s</text>
<text text-anchor="middle" x="818.38" y="-2221.52" font-family="Arial" font-size="11.00">Total: 15&#45;60s</text>
<text text-anchor="middle" x="818.38" y="-2195.02" font-family="Arial" font-size="11.00">Concurrency Limits:</text>
<text text-anchor="middle" x="818.38" y="-2181.52" font-family="Arial" font-size="11.00">&#45; Global: 10 documents</text>
<text text-anchor="middle" x="818.38" y="-2168.02" font-family="Arial" font-size="11.00">&#45; Per&#45;user: 5 documents</text>
<text text-anchor="middle" x="818.38" y="-2154.52" font-family="Arial" font-size="11.00">&#45; Page rendering: 3 concurrent</text>
</g>
<!-- biomarker_model -->
<g id="node39" class="node">
<title>biomarker_model</title>
<polygon fill="white" stroke="black" points="1325.88,-2370.47 1138.88,-2370.47 1138.88,-2173.97 1331.88,-2173.97 1331.88,-2364.47 1325.88,-2370.47"/>
<polyline fill="none" stroke="black" points="1325.88,-2370.47 1325.88,-2364.47"/>
<polyline fill="none" stroke="black" points="1331.88,-2364.47 1325.88,-2364.47"/>
<text text-anchor="middle" x="1235.38" y="-2356.02" font-family="Arial" font-size="11.00">Biomarker:</text>
<text text-anchor="middle" x="1235.38" y="-2342.52" font-family="Arial" font-size="11.00">&#45; long_name, short_name</text>
<text text-anchor="middle" x="1235.38" y="-2329.02" font-family="Arial" font-size="11.00">&#45; document_name</text>
<text text-anchor="middle" x="1235.38" y="-2315.52" font-family="Arial" font-size="11.00">&#45; aliases: list[str]</text>
<text text-anchor="middle" x="1235.38" y="-2302.02" font-family="Arial" font-size="11.00">&#45; values: list[BiomarkerValue]</text>
<text text-anchor="middle" x="1235.38" y="-2288.52" font-family="Arial" font-size="11.00">&#45; specimen_type</text>
<text text-anchor="middle" x="1235.38" y="-2275.02" font-family="Arial" font-size="11.00">&#45; panel_name</text>
<text text-anchor="middle" x="1235.38" y="-2248.52" font-family="Arial" font-size="11.00">BiomarkerValue:</text>
<text text-anchor="middle" x="1235.38" y="-2235.02" font-family="Arial" font-size="11.00">&#45; value, unit</text>
<text text-anchor="middle" x="1235.38" y="-2221.52" font-family="Arial" font-size="11.00">&#45; observation_date, observation_time</text>
<text text-anchor="middle" x="1235.38" y="-2208.02" font-family="Arial" font-size="11.00">&#45; name_location (page, x, y, w, h)</text>
<text text-anchor="middle" x="1235.38" y="-2194.52" font-family="Arial" font-size="11.00">&#45; value_location (page, x, y, w, h)</text>
<text text-anchor="middle" x="1235.38" y="-2181.02" font-family="Arial" font-size="11.00">&#45; unit_location (page, x, y, w, h)</text>
</g>
<!-- pattern -->
<g id="node40" class="node">
<title>pattern</title>
<polygon fill="white" stroke="black" points="1632.25,-2383.47 1462.5,-2383.47 1462.5,-2160.97 1638.25,-2160.97 1638.25,-2377.47 1632.25,-2383.47"/>
<polyline fill="none" stroke="black" points="1632.25,-2383.47 1632.25,-2377.47"/>
<polyline fill="none" stroke="black" points="1638.25,-2377.47 1632.25,-2377.47"/>
<text text-anchor="middle" x="1550.38" y="-2369.02" font-family="Arial" font-size="11.00">Multi&#45;Tenancy Pattern:</text>
<text text-anchor="middle" x="1550.38" y="-2342.52" font-family="Arial" font-size="11.00">Instance Layer (Patient&#45;Specific):</text>
<text text-anchor="middle" x="1550.38" y="-2329.02" font-family="Arial" font-size="11.00">&#45; DocumentReferenceNode</text>
<text text-anchor="middle" x="1550.38" y="-2315.52" font-family="Arial" font-size="11.00">&#45; ObservationValueNode</text>
<text text-anchor="middle" x="1550.38" y="-2302.02" font-family="Arial" font-size="11.00">Contains patient_id for scoping</text>
<text text-anchor="middle" x="1550.38" y="-2275.52" font-family="Arial" font-size="11.00">Type Layer (Shared):</text>
<text text-anchor="middle" x="1550.38" y="-2262.02" font-family="Arial" font-size="11.00">&#45; ObservationTypeNode</text>
<text text-anchor="middle" x="1550.38" y="-2248.52" font-family="Arial" font-size="11.00">Shared across all patients</text>
<text text-anchor="middle" x="1550.38" y="-2222.02" font-family="Arial" font-size="11.00">Benefits:</text>
<text text-anchor="middle" x="1550.38" y="-2208.52" font-family="Arial" font-size="11.00">&#45; No data duplication for types</text>
<text text-anchor="middle" x="1550.38" y="-2195.02" font-family="Arial" font-size="11.00">&#45; Consistent biomarker definitions</text>
<text text-anchor="middle" x="1550.38" y="-2181.52" font-family="Arial" font-size="11.00">&#45; Efficient catalog integration</text>
<text text-anchor="middle" x="1550.38" y="-2168.02" font-family="Arial" font-size="11.00">&#45; Patient data isolation</text>
</g>
</g>
</svg>
